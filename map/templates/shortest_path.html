{% extends 'base.html' %}

{% block content %}

<!-- Меню с формой -->
<div class="menu">
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Найти маршрут</button>
    </form>
</div>


<div id="map" style="height: 600px; width: 600px;"></div>

<script>

    var map = L.map('map', {attributionControl: false}).setView([59.939095, 30.315877], 13);

    var CartoDB_DarkMatter = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
    subdomains: 'abcd',
    maxZoom: 20
}).addTo(map);


 // Отрисовка маршрута, если он есть
{% if path_coordinates %}
    console.log("Координаты пути из Django:", {{ path_coordinates|safe }});  // Отладочная информация
    var coordinates = {{ path_coordinates|safe }};  // Передаём координаты из Django в JavaScript
    L.polyline(coordinates, {color: 'blue'}).addTo(map);
{% endif %}

// Отрисовка полигонов для начальной и конечной точек
{% if start_geometry %}
    var startGeoJSON = {{ start_geometry|safe }};
    var startPolygon = L.geoJSON(startGeoJSON, {
        style: { color: 'green', fillOpacity: 0.5 }
    }).addTo(map);
    startPolygon.bindPopup("Начальная точка").openPopup();
{% endif %}

{% if end_geometry %}
    var endGeoJSON = {{ end_geometry|safe }};
    var endPolygon = L.geoJSON(endGeoJSON, {
        style: { color: 'red', fillOpacity: 0.5 }
    }).addTo(map);
    endPolygon.bindPopup("Конечная точка").openPopup();
{% endif %}
</script>

{% endblock %}
